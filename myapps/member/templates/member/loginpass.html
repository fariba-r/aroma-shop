
{%extends 'base.html'%}

{%block content%}


 <!-- ================ start banner area ================= -->	
	<section class="blog-banner-area" id="category">
		<div class="container h-100">
			<div class="blog-banner">
				<div class="text-center">
					<h1>Login / Register</h1>
					<nav aria-label="breadcrumb" class="banner-breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="#">Home</a></li>
              <li class="breadcrumb-item active" aria-current="page">Login/Register</li>
            </ol>
          </nav>
				</div>
			</div>
    </div>
	</section>
	<!-- ================ end banner area ================= -->
  
  <!--================Login Box Area =================-->
	<section class="login_box_area section-margin">
		<div class="container">
			<div class="row">
				<div class="col-lg-6">
					<div class="login_box_img">
						<div class="hover">
							<h4>New to our website?</h4>
							<p>There are advances being made in science and technology everyday, and a good example of this is the</p>
							<a class="button button-account" href="{% url 'member:signup' %}">Create an Account</a>
						</div>
					</div>
				</div>
				<div class="col-lg-6">
					<div class="login_form_inner ">
						<h3>Log in to enter</h3>
                        <form method="post" class="row login_form justify-content-center" action="#/" id="contactForm" >
                        {% csrf_token %}
{#                        {% for field in form %}#}
{#							<div class="col-md-12 form-group">#}
{#                            #}
{#								{% comment %} <div type="text" class="form-control" id="name" name="name" placeholder=".." onfocus="this.placeholder = ''" onblur="this.placeholder = 'Username'"> {% endcomment %}#}
{#                                {{ field }}#}
{#                                {% comment %} </div> {% endcomment %}#}
{#                                {% if field.errors %}#}
{#	        		                <small>{{ field.errors|striptags }}</small> #}
{#	        	                {% endif %}#}
{#		#}
{#							</div>#}
{#                            {% endfor %}#}
                            <h3 id="message"></h3>
                            <input id="username" name="username" placeholder="username" class="mb-4">
                            <input id="password" name="password" placeholder="password" type="password" class="mb-4">
							
							{% comment %} <div class="col-md-12 form-group">
								<div class="creat_account">
									<input type="checkbox" id="f-option2" name="selector">
									<label for="f-option2">Keep me logged in</label>
								</div>
							</div> {% endcomment %}
							<div class="col-md-12 form-group">
								<button type="submit" value="submit"  id="submit" class="button button-login w-100">Log In</button>
								<a href="#">Forgot Password?</a>
								<a href={%  url 'member:loginemail' %}>Enter with email code?</a>
							</div>
						</form>
                       
					</div>
				</div>
			</div>
		</div>
	</section>
	<!--================End Login Box Area =================-->


{%endblock content%}


{% block extra_js %}

    <script>
        let cookie = document.cookie
        let csrfToken = cookie.substring(cookie.indexOf('=') + 1)

        function setCookie(name, value, days) {
            var expires = new Date();
            expires.setTime(expires.getTime() + days * 24 * 60 * 60 * 1000); // 2 days in milliseconds
            document.cookie = name + "=" + value + "; expires=" + expires.toUTCString() + "; path=/";
        }

        // Usage:

        document.getElementById("submit").addEventListener("click", function (event) {
            event.preventDefault()

            var username = document.getElementById("username")
            var password = document.getElementById("password")
            {#fetch('http://127.0.0.1:8000/api/token/',{#}
            fetch('http://127.0.0.1:8000/member/loginpassapi/', {
                method: "POST",

                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken

                },

                body: JSON.stringify({
                    'username': document.getElementById("username").value,
                    'password': document.getElementById("password").value
                })
            }).then(response => response.json())

                .then(data => {
                    if (data.status == 200) {


                        fetch('http://127.0.0.1:8000/api/token/', {
                            method: "POST",
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': csrfToken

                            },

                            body: JSON.stringify({
                                'username': document.getElementById("username").value,
                                'password': document.getElementById("password").value
                            })


                        })
                            .then(response => response.json())
                            .then(data => {
                                console.log(data.access);
                                debugger
                                setCookie("jwt", data.access, 2);


                                window.location.href = 'http://localhost:8000/home' +
                                    '';

                            })

                    }//end if
                    if (data.status == 404) {
                        document.getElementById("message").innerHTML = data.message


                    } else {
                        document.getElementById("message").innerHTML = data.message
                    }

                })//end then
                .catch(error => {
                    console.log(error)
                })
        })//end addeven lessener
        {#setCookie("jwt", "vvv", 2);#}




    </script>
{% endblock extra_js %}